id: SCULK_UNDERGROUND
type: FEATURE

# Adds 'webs' of leaf blocks to surface blocks

distributor:
  type: SAMPLER
  sampler:
    type: PROBABILITY
    sampler:
      type: OPEN_SIMPLEX_2
      frequency: 0.03
  threshold: 0.75

locator:
  type: AND
  locators:
    # Check if block is solid block
    - type: PATTERN
      range: &range
        min: -64
        max: 64
      pattern:
        type: MATCH_SET
        blocks: $features/vegetation/meta.yml:sculk-plantable-blocks
        offset: 0
    # Check if there is a surrounding solid block
    - type: OR
      locators:
        # If any side faces are air
        - type: ADJACENT_PATTERN
          range: *range
          pattern:
            type: MATCH_AIR
            offset: 0
        # OR any top / bottom faces are air
        - type: PATTERN
          range: *range
          pattern:
            type: OR
            patterns:
              - type: MATCH_AIR
                offset: 1
              - type: MATCH_AIR
                offset: -1
    # Use noise to create 'webbed' effect
    - type: SAMPLER_3D
      sampler:
        dimensions: 3
        type: EXPRESSION
        variables:
          threshold: 0.5
        expression: if(noise(x,y,z) > threshold, 1, -1)
        samplers:
          noise:
            # Warped distance2div produces a web effect
            dimensions: 3
            type: DOMAIN_WARP
            amplitude: 14
            warp:
              type: FBM
              octaves: 2
              sampler:
                type: OPEN_SIMPLEX_2
            sampler:
              type: LINEAR
              min: -1
              max: 0
              sampler:
                type: CELLULAR
                return: Distance2Div
                frequency: 0.025

structures:
  distribution:
    type: DOMAIN_WARP
    amplitude: 4
    warp:
      type: GAUSSIAN
    sampler:
      type: CELLULAR
      return: CellValue
      frequency: 0.06
      seed: 4417
  structures:
    - BLOCK:minecraft:sculk: 1