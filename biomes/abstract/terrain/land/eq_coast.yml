id: EQ_COAST
type: BIOME
abstract: true

vars: &variables
  base: $meta.yml:terrain.base
  scale: $meta.yml:terrain.scale
  erosionBottom: 50

terrain:
  sampler:
    type: EXPRESSION
    dimensions: 3
    variables: *variables
    expression: |
      -y + base +
      erode(
        erosionBottom + bottomVariation(x, z) * 10,
        base,
        globalHeightmap(x,z)*(1+variation(x,z)*0.3),
        scale,
        y,
        1-erosion(x, z)
      )
    samplers: &samplers
      variation:
        dimensions: 2
        type: OPEN_SIMPLEX_2
        frequency: 0.02
        salt: 5
      erosion:
        dimensions: 2
        type: PROBABILITY
        sampler:
          type: RIDGED
          octaves: 1
          gain: 1
          sampler:
            type: OPEN_SIMPLEX_2
            frequency: 0.01
            salt: 2
      bottomVariation:
        dimensions: 2
        type: PROBABILITY
        sampler:
          type: OPEN_SIMPLEX_2
          frequency: 0.005
          salt: 9
    functions:
      erode:
        arguments: [ bottom, base, height, scale, y, erosion ]
        expression: |
          -lerp(y,
            base+height*scale, 0,
            base+height*scale/10,
            lerp(y,
              base+height*scale/10, erosion * (-y+base+height*scale) * lerp(height, 0.05, 0, 0.3, 4),
              bottom, 0
            )
          )
        functions: $math/functions/lerp.yml:functions

  sampler-2d:
    type: EXPRESSION
    variables: *variables
    samplers: *samplers
    expression: globalHeightmap(x, z) * scale