id: CARVING_LAND
type: BIOME
abstract: true

carving:
  sampler:
    dimensions: 3
    type: EXPRESSION
    variables:

      carvingThreshold: 0.55 # Higher = less carving
      carvingMinHeight: -54
      carvingMaxHeight: 100
      carvingClampTaper: 30
      carvingMax: 1 # Caps the amount of base carving
      
      cheeseStrength: 0.8
      cheeseHorizontalFrequency: 1.5
      cheeseVerticalFrequency: 3
      
      pillarStrength: 0.5
    
    expression: |
      -carvingThreshold
      + if(y<carvingMinHeight||y>carvingMaxHeight,0,maskSmooth(maskSmooth(
        // Base carving - Assumes a range of [0, carvingMax]
        min(carvingMax,
          // Cheese caves - assumes a range of [0, cheeseStrength]
          (simplex3(
            x * cheeseHorizontalFrequency,
            (y + simplex2(x, z) * 5) * cheeseVerticalFrequency,
            z * cheeseHorizontalFrequency
          )+1)/2 // Linear redistribute
          * cheeseStrength
        )
        // --- Pillars - Subtracts from base carving to produce pillars
        -(cavePillars(x, z)+1)/2 * pillarStrength
        ,
        // Clamp parameters
        carvingMinHeight, carvingMinHeight + carvingClampTaper, y
        ),
        carvingMaxHeight, carvingMaxHeight - carvingClampTaper, y
      ))
    
    samplers:
      cavePillars:
        dimensions: 2
        type: LINEAR
        min: 0.98
        max: 1
        function:
          type: CLAMP
          min: 0.98
          max: 1
          function:
            type: EXPRESSION
            expression: -cell(x, z)
            samplers:
              cell:
                dimensions: 2
                type: CELLULAR
                frequency: 0.05
      
      # Basic 2D simplex noise
      simplex2:
        dimensions: 2
        type: LINEAR
        min: -0.9
        max: 0.9
        function:
          type: FBM
          octaves: 4
          function:
            type: OPEN_SIMPLEX_2
            frequency: 0.0075
      
      # Basic 3D simplex noise
      simplex3:
        dimensions: 3
        type: FBM
        octaves: 2
        function:
          type: OPEN_SIMPLEX_2
          frequency: 0.0075